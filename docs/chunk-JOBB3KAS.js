import{a as se}from"./chunk-FYLT2MHV.js";import{f as ne,m as oe,n as re}from"./chunk-L2HEO6U7.js";import{F as ie}from"./chunk-JYJCGWMW.js";import{A as W,C as X,F as Y,G as ee,J as te,b as R,h as z,i as N,j as O,k,l as U,m as M,o as V,p as $,q as G,s as J,t as Z,u as q,v as K,w as Q}from"./chunk-RADV76JZ.js";import{$a as B,Ea as P,Ja as T,L as H,M as w,Ma as j,V as s,Va as A,W as g,Wa as L,Y as C,Za as _,aa as h,ab as F,ea as m,ga as n,ha as a,ia as d,ma as D,na as E,oa as u,xa as c,ya as x,za as v}from"./chunk-KV6L2PIJ.js";import"./chunk-A2PWH3LV.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{g as b}from"./chunk-OLRFWS6T.js";function ae(e,l){e&1&&(n(0,"div",3),d(1,"ion-spinner",4),n(2,"p"),c(3,"Loading service history..."),a()())}function le(e,l){if(e&1){let i=D();n(0,"div",3),d(1,"ion-icon",5),n(2,"p"),c(3),a(),n(4,"ion-button",6),E("click",function(){H(i);let o=u();return w(o.loadServiceHistory())}),d(5,"ion-icon",7),c(6," Try Again "),a()()}if(e&2){let i=u();s(3),x(i.error)}}function ce(e,l){e&1&&(n(0,"div",3),d(1,"ion-icon",8),n(2,"p"),c(3,"No service history found"),a()())}function de(e,l){if(e&1&&(n(0,"ion-row")(1,"ion-col",11)(2,"ion-label"),d(3,"ion-icon",14),c(4),a()()()),e&2){let i=u().$implicit;s(4),v(" ",i.selectedProperty.name," ")}}function me(e,l){if(e&1&&(n(0,"ion-row")(1,"ion-col",11)(2,"ion-label"),d(3,"ion-icon",15),c(4),a()()()),e&2){let i=u().$implicit;s(4),v(" ",i.additionalInfo," ")}}function pe(e,l){if(e&1&&(n(0,"ion-item")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),c(4),a(),n(5,"ion-badge",10),c(6),a()(),n(7,"ion-card-content")(8,"ion-grid")(9,"ion-row")(10,"ion-col",11)(11,"ion-label"),d(12,"ion-icon",12),c(13),a()()(),n(14,"ion-row")(15,"ion-col",11)(16,"ion-label"),d(17,"ion-icon",13),c(18),T(19,"currency"),a()()(),h(20,de,5,1,"ion-row",2)(21,me,5,1,"ion-row",2),a()()()()),e&2){let i=l.$implicit,t=u(2);s(4),x(i.serviceType||"Service"),s(),m("color",i.serviceStatus==="Completed"?"success":"warning"),s(),v(" ",i.serviceStatus," "),s(7),v(" ",t.formatDate(i.createdAt)," "),s(5),v(" ",j(19,7,i.totalCostToUser,"ZAR","symbol-narrow")," "),s(2),m("ngIf",i.selectedProperty==null?null:i.selectedProperty.name),s(),m("ngIf",i.additionalInfo)}}function ue(e,l){if(e&1&&(n(0,"ion-list"),h(1,pe,22,11,"ion-item",9),a()),e&2){let i=u();s(),m("ngForOf",i.serviceHistory)}}var xe=(()=>{let l=class l{constructor(t,o,r,p){this.jobsService=t,this.datePipe=o,this.auth=r,this.firestore=p,this.serviceHistory=[],this.isLoading=!0,this.error=null,this.userRole=null,this.userId=null}ngOnInit(){this.loadServiceHistory()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}loadServiceHistory(){return b(this,null,function*(){let t=this.auth.currentUser;if(!t){console.warn("User not logged in."),this.isLoading=!1;return}this.userId=t.uid;let o=oe(this.firestore,"users",t.uid),r=yield re(o);if(r.exists()){let p=r.data();this.userRole=p.role}else{console.warn("User data not found."),this.isLoading=!1;return}this.isLoading=!0,this.error=null,this.jobsService.getServiceHistoryByStatus("Completed").subscribe({next:p=>{this.jobsService.getServiceHistoryByStatus("Cancelled").subscribe({next:y=>{this.jobsService.getServiceHistoryByStatus("finalized").subscribe({next:I=>{let f=[...p,...y,...I];console.log(f),this.userRole==="user"?f=f.filter(S=>S.userId===this.userId):this.userRole==="service-provider"&&(f=f.filter(S=>S.cleanerID===this.userId)),this.serviceHistory=f,this.sortByDate(),this.isLoading=!1},error:I=>{console.error("Error fetching finalized jobs:",I),this.error="Failed to load finalized jobs",this.isLoading=!1}})},error:y=>{console.error("Error fetching cancelled jobs:",y),this.error="Failed to load cancelled jobs",this.isLoading=!1}})},error:p=>{console.error("Error fetching completed jobs:",p),this.error="Failed to load completed jobs",this.isLoading=!1}})})}sortByDate(){this.serviceHistory.sort((t,o)=>{let r=t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt);return(o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)).getTime()-r.getTime()})}formatDate(t){if(!t)return"N/A";try{let o=t instanceof Date?t:new Date(t);return this.datePipe.transform(o,"mediumDate")||"N/A"}catch{return"N/A"}}};l.\u0275fac=function(o){return new(o||l)(g(se),g(_),g(ie),g(ne))},l.\u0275cmp=C({type:l,selectors:[["app-service-history"]],features:[P([_])],decls:11,vars:4,consts:[["slot","start"],["class","ion-text-center ion-padding",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-padding"],["name","crescent"],["name","warning","size","large"],["fill","clear",3,"click"],["slot","start","name","refresh"],["name","time-outline","size","large"],[4,"ngFor","ngForOf"],[3,"color"],["size","12"],["name","calendar-outline","slot","start"],["name","cash-outline","slot","start"],["name","home-outline","slot","start"],["name","document-text-outline","slot","start"]],template:function(o,r){o&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),d(3,"ion-back-button"),a(),n(4,"ion-title"),c(5,"Service History"),a()()(),n(6,"ion-content"),h(7,ae,4,0,"div",1)(8,le,7,1,"div",1)(9,ce,4,0,"div",1)(10,ue,2,1,"ion-list",2),a()),o&2&&(s(7),m("ngIf",r.isLoading),s(),m("ngIf",!r.isLoading&&r.error),s(),m("ngIf",!r.isLoading&&!r.error&&r.serviceHistory.length===0),s(),m("ngIf",!r.isLoading&&!r.error&&r.serviceHistory.length>0))},dependencies:[R,O,J,$,W,N,te,F,A,L,B,Z,ee,Y,G,Q,q,k,M,V,U,K,z,X],encapsulation:2});let e=l;return e})();export{xe as ServiceHistoryPage};
