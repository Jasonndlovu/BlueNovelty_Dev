import{a as le}from"./chunk-FFIFK57Q.js";import{A as re,C as ae,e as Z,n as D,o as ee,p as te,q as ie,s as ne,u as oe}from"./chunk-MVKRSWIK.js";import{B as I,Ca as P,Fb as U,Gb as F,I as x,J as g,Lb as V,Mb as R,Na as T,Nb as q,Oa as O,Ob as z,Pb as B,Qb as $,Ra as _,S as c,Sa as j,Sb as H,T as h,Tb as L,Ub as W,V as M,Xb as G,Y as b,_b as K,aa as u,ec as Q,fa as n,ga as i,ha as k,i as C,ic as X,jc as Y,la as S,m as v,ma as f,na as p,nb as N,wa as o,xa as A,ya as d,z as y}from"./chunk-AQGY4TKS.js";import"./chunk-A2PWH3LV.js";import"./chunk-7KGURMOZ.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as J,b as w}from"./chunk-OLRFWS6T.js";var se=(()=>{let r=class r{constructor(e,t){this.firestore=e,this.auth=t}getServiceReviews(){let e=oe(this.firestore,"service-requests"),t=re(e,ae("isAvailable","==",!0));return console.log("here is q: "+t),ne(t,{idField:"id"}).pipe(v(l=>l.map(m=>{var E;return w(J({},m),{createdAt:((E=m.createdAt)==null?void 0:E.toDate())||new Date})})))}getUserName(e){let t=D(this.firestore,"users",e);return C(ee(t)).pipe(v(l=>{if(l.exists()){let m=l.data();return(m==null?void 0:m.displayName)||"Unknown"}else return"Unknown"}))}updateJobStatus(e,t){let l=D(this.firestore,"service-requests",e);return te(l,{isAvailable:!1,cleanerID:t.uid})}};r.\u0275fac=function(t){return new(t||r)(I(ie),I(Z))},r.\u0275prov=y({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();function me(s,r){s&1&&(n(0,"ion-badge",6),o(1,"Available"),i())}function pe(s,r){if(s&1){let a=S();n(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),o(3),i(),b(4,me,2,0,"ion-badge",3),i(),n(5,"ion-card-content")(6,"p"),o(7),i(),n(8,"p"),o(9),i(),n(10,"p"),o(11),i(),n(12,"ion-row")(13,"ion-col")(14,"ion-button",4),f("click",function(){let t=x(a).$implicit,l=p();return g(l.acceptJob(t,l.user))}),o(15,"Accept"),i()(),n(16,"ion-col")(17,"ion-button",5),f("click",function(){let t=x(a).$implicit,l=p();return g(l.declineJob(t))}),o(18,"Decline"),i()()()()()}if(s&2){let a=r.$implicit,e=p();c(3),A(a.selectedProperty),c(),u("ngIf",a.isAvailable),c(3),d("Client: ",e.userNames[a.userId]||"Unknown",""),c(2),d("Extras: ",a.selectedExtras,""),c(2),d("Scheduled for: ",e.formatScheduledDate(a.selectedTimeAndDate),"")}}function be(s,r){if(s&1&&(n(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),o(3),i()(),n(4,"ion-card-content")(5,"p")(6,"strong"),o(7,"Extras:"),i(),o(8),i(),n(9,"p")(10,"strong"),o(11,"Scheduled Time:"),i(),o(12),i(),n(13,"p")(14,"strong"),o(15,"Status:"),i(),o(16),i(),n(17,"p")(18,"strong"),o(19,"Created At:"),i(),o(20),i()()()),s&2){let a=p(2);c(3),A(a.selectedJob.selectedProperty),c(5),d(" ",a.selectedJob.selectedExtras,""),c(4),d(" ",a.formatScheduledDate(a.selectedJob.selectedTimeAndDate),""),c(4),d(" ",a.selectedJob.isAvailable?"Available":"Assigned",""),c(4),d(" ",a.selectedJob.createdAt,"")}}function ue(s,r){if(s&1){let a=S();n(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o(3,"Job Details"),i(),n(4,"ion-buttons",7)(5,"ion-button",8),f("click",function(){x(a);let t=p();return g(t.closeModal())}),o(6,"Close"),i()()()(),n(7,"ion-content"),b(8,be,21,5,"ion-card",9),i()}if(s&2){let a=p();c(8),u("ngIf",a.selectedJob)}}var Ce=(()=>{let r=class r{constructor(e,t,l){this.availableJobsService=e,this.datePipe=t,this.authService=l,this.user=null,this.jobs=[],this.userNames={},this.isModalOpen=!1}ngOnInit(){this.fetchUserDetails(),this.getAvailableJobs()}formatScheduledDate(e){return this.datePipe.transform(e,"HH:mm yyyy-MM-dd")||""}getAvailableJobs(){this.availableJobsService.getServiceReviews().subscribe(e=>{this.jobs=e,this.fetchUserNames()},e=>{console.error("Error fetching available jobs:",e)})}fetchUserNames(){this.jobs.forEach(e=>{e.userId&&!this.userNames[e.userId]&&this.availableJobsService.getUserName(e.userId).subscribe(t=>{this.userNames[e.userId]=t})})}acceptJob(e,t){if(!t){console.error("User is not logged in");return}if(!e.id){console.error("Job ID is undefined");return}this.availableJobsService.updateJobStatus(e.id,t).then(()=>{console.log(`Job ${e.id} has been accepted and updated.`),e.isAvailable=!1,e.cleanerID=t.uid}).catch(l=>{console.error("Error accepting the job:",l)})}declineJob(e){e.isAvailable=!0,console.log(`Declined job: ${e.id}`)}fetchUserDetails(){this.authService.getCurrentUser().subscribe(e=>{this.user=e})}viewInfo(e){this.selectedJob=e,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}};r.\u0275fac=function(t){return new(t||r)(h(se),h(_),h(le))},r.\u0275cmp=M({type:r,selectors:[["app-available-jobs"]],features:[P([_])],decls:11,vars:2,consts:[["slot","start"],[4,"ngFor","ngForOf"],[3,"ionModalDidDismiss","isOpen"],["color","primary",4,"ngIf"],[1,"Accept",3,"click"],[1,"Decline",3,"click"],["color","primary"],["slot","end"],[3,"click"],[4,"ngIf"]],template:function(t,l){t&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),k(3,"ion-back-button"),i(),n(4,"ion-title"),o(5,"Available Jobs"),i()()(),n(6,"ion-content")(7,"ion-list"),b(8,pe,19,5,"ion-card",1),i(),n(9,"ion-modal",2),f("ionModalDidDismiss",function(){return l.closeModal()}),b(10,ue,9,1,"ng-template"),i()()),t&2&&(c(8),u("ngForOf",l.jobs),c(),u("isOpen",l.isModalOpen))},dependencies:[F,L,Q,R,B,H,$,z,K,U,q,V,W,G,X,Y,j,T,O,N],styles:["ion-badge[_ngcontent-%COMP%]{font-size:.8rem;padding:5px 10px;border-radius:5px}ion-card[_ngcontent-%COMP%]{margin-bottom:10px}.Accept[_ngcontent-%COMP%]{margin:0 auto;width:60%;font-size:.8rem;height:10px;text-align:center;font-style:normal;font-weight:700;font-size:10px;line-height:100%;--background: #1E232C;--color: White;--border-radius: 100px;--border-color: #000;--border-style: solid;--border-width: 1px;--box-shadow: 0 2px 6px 0 rgb(0, 0, 0, .25);--ripple-color: deeppink;--padding-top: 10px;--padding-bottom: 10px}.Decline[_ngcontent-%COMP%]{margin:0 auto;width:60%;font-size:.8rem;height:10px;text-align:center;font-style:normal;font-weight:700;font-size:10px;line-height:18px;--background: #DADADA;--color: black;--border-radius: 100px;--border-color: #000;--border-style: solid;--border-width: 1px;--box-shadow: 0 2px 6px 0 rgb(0, 0, 0, .25);--ripple-color: deeppink;--padding-top: 10px;--padding-bottom: 10px}"]});let s=r;return s})();export{Ce as AvailableJobsPage};
