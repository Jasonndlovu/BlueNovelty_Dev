import{a as ge}from"./chunk-YCA6ITIU.js";import{a as he}from"./chunk-B7JSY7TB.js";import{A as pe,C as j,E as T,a as X,c as Z,e as E,f as ee,g as te,h as ie,i as ne,k as oe,l as k,o as re,p as ae,r as le,s as se,u as de,v as ce,y as me,z as ue}from"./chunk-LNBB6RTL.js";import"./chunk-36AM222O.js";import"./chunk-7QQQ4XSS.js";import"./chunk-E66F5ZP3.js";import"./chunk-HC6MZPB3.js";import"./chunk-2SDYHWHI.js";import{a as Q}from"./chunk-32NLN7J2.js";import"./chunk-4PGTP63H.js";import"./chunk-FW7FQTSR.js";import"./chunk-FERD25SW.js";import"./chunk-HMTYJH34.js";import"./chunk-VFZRLGVJ.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-C5FLGXKQ.js";import"./chunk-Q7SJDITE.js";import"./chunk-MCRJI3T3.js";import"./chunk-MM5QLNJM.js";import"./chunk-NHOGAROI.js";import"./chunk-72KDLSWN.js";import{a as $}from"./chunk-3BWVIFHI.js";import"./chunk-6CACEU2V.js";import{F as K}from"./chunk-ZGICK3R3.js";import{Aa as i,Ba as V,Ca as p,Ea as A,Fa as O,Ga as F,L as y,M as x,Pa as W,U,V as r,W as h,Xa as z,Xb as Y,Y as _,Ya as q,_b as G,aa as f,cb as S,ea as m,ib as H,ja as n,ka as e,kc as C,la as w,pa as P,qa as v,ra as b,za as L}from"./chunk-RFSKJ54S.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-LF5XB4YN.js";import{g}from"./chunk-OLRFWS6T.js";var fe=(()=>{let s=class s{constructor(a,l){this.modalCtrl=a,this.reviewService=l,this.message="",this.rating=5}ngOnInit(){}addReview(){return g(this,null,function*(){try{let a=yield this.reviewService.addReview(this.jobId,this.message,this.rating,this.recipientId);console.log("Review added:",a),this.modalCtrl.dismiss({submitted:!0},"submit")}catch(a){console.error("Error adding review:",a)}})}closeModal(){this.modalCtrl.dismiss(null,"cancel")}};s.\u0275fac=function(l){return new(l||s)(h(j),h(he))},s.\u0275cmp=_({type:s,selectors:[["app-review-modal"]],inputs:{serviceId:"serviceId",jobId:"jobId",role:"role",recipientId:"recipientId"},decls:15,vars:2,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModelChange","ngModel"],["min","1","max","5","step","1","snaps","","pin","",3,"ngModelChange","ngModel"],["slot","start"],["slot","end"],["color","dark",3,"click"]],template:function(l,t){l&1&&(n(0,"ion-content",0)(1,"ion-item")(2,"ion-label",1),i(3,"Your Feedback"),e(),n(4,"ion-textarea",2),F("ngModelChange",function(c){return O(t.message,c)||(t.message=c),c}),e()(),n(5,"ion-item")(6,"ion-label"),i(7,"Rating"),e(),n(8,"ion-range",3),F("ngModelChange",function(c){return O(t.rating,c)||(t.rating=c),c}),n(9,"ion-label",4),i(10,"1"),e(),n(11,"ion-label",5),i(12,"5"),e()()(),n(13,"ion-button",6),v("click",function(){return t.addReview()}),i(14,"Submit"),e()()),l&2&&(r(4),A("ngModel",t.message),r(4),A("ngModel",t.rating))},dependencies:[S,C,Y,G,T,E,k,le,se,ce,me,X,Z],encapsulation:2});let o=s;return o})();function Ie(o,s){o&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",21),w(3,"ion-menu-button"),e(),n(4,"ion-title"),i(5,"View Service"),e()()())}function ye(o,s){if(o&1&&w(0,"img",22),o&2){let u=b();m("src",u.otherPartyInfo.photoURL,U)}}function xe(o,s){o&1&&(n(0,"div",23),w(1,"ion-icon",24),e())}function we(o,s){if(o&1&&(n(0,"div",25)(1,"p")(2,"strong"),i(3,"Booking frequency:"),e(),i(4),e()()),o&2){let u=b();r(4),p(" ",u.bookingFrequency,"")}}function _e(o,s){if(o&1&&(n(0,"div",25)(1,"p")(2,"strong"),i(3,"Booking day of the month:"),e(),i(4),e()()),o&2){let u=b();r(4),p(" ",u.recurringDate,"th")}}function Se(o,s){if(o&1&&(n(0,"div",25)(1,"p")(2,"strong"),i(3,"Every:"),e(),i(4),e()()),o&2){let u=b();r(4),p(" ",u.recurringDay,"")}}function Ce(o,s){if(o&1&&(n(0,"li"),i(1),e()),o&2){let u=s.$implicit;r(),V(u)}}function Ee(o,s){if(o&1&&(n(0,"div")(1,"h3",5),i(2,"Extras"),e(),n(3,"ul",26),f(4,Ce,2,1,"li",27),e()()),o&2){let u=b();r(4),m("ngForOf",u.jobItems)}}function ke(o,s){if(o&1){let u=P();n(0,"button",28),v("click",function(){y(u);let l=b();return x(l.openReviewModal())}),i(1," Add Review "),e()}}var qe=(()=>{let s=class s{constructor(a,l,t,d,c){var N,B;this.modalController=a,this.router=l,this.availableJobsService=t,this.auth=d,this.userService=c,this.user=null,this.isUpcomingJob=!1,this.editMode=!1,this.role="user";let M=this.router.getCurrentNavigation(),I=(N=M==null?void 0:M.extras)==null?void 0:N.state;if(I){console.log(I),this.job=I.job,this.editMode=I.editMode,this.role=I.role,console.log(this.job),this.jobId=this.job.id,this.jobType=this.job.serviceType,this.userId=this.job.userId,this.price=this.job.totalCostToUser,this.additionalInfo=this.job.additionalInfo,this.bookingType=this.job.bookingType,this.scheduledDate=this.job.selectedTimeAndDate,this.userConfirmed=this.job.userConfirmed,this.cleanerConfirmed=(B=this.job)==null?void 0:B.cleanerConfirmed,this.bookingFrequency=this.job.recurringOption||"None",this.recurringDay=this.job.recurringDay||"N/A",this.recurringDate=this.job.recurringDate||"N/A";let J=this.job.selectedExtras;if(this.jobItems=J?J.split(",").map(R=>R.trim()):[],this.scheduledDate){let[R,D]=this.scheduledDate.split("T");this.scheduledDateOnly=R,this.scheduledTimeOnly=D==null?void 0:D.slice(0,5)}}else console.warn("No state data found. Redirecting back."),this.router.navigate(["/upcoming-jobs"])}ngOnInit(){this.auth.onAuthStateChanged(l=>g(this,null,function*(){this.user=l}));let a=this.role==="user"?this.job.cleanerID:this.job.userId;this.userService.getUserById(a).subscribe(l=>{this.otherPartyInfo=l},l=>{console.error("Error loading user:",l)})}backtoDash(){this.router.navigate(["/dashboard"])}startChat(a){this.user&&this.router.navigate([`/chat/${this.user.uid}-${a.uid}`])}markServiceComplete(){return g(this,null,function*(){if(!this.user||!this.jobId)return;let a=this.role==="service-provider"?"cleanerConfirmed":"userConfirmed";try{yield this.availableJobsService.updateJobConfirmation(this.jobId,a,!0),console.log(`${a} set to true`),this.checkAndFinalizeServiceCompletion(),this.backtoDash()}catch(l){console.error("Error updating confirmation:",l)}})}checkAndFinalizeServiceCompletion(){return g(this,null,function*(){let a=yield this.availableJobsService.getJobById(this.jobId);if((a==null?void 0:a.cleanerConfirmed)&&(a==null?void 0:a.userConfirmed)){let t=this.job.cleanerID,d=Math.round((this.price||0)*.9);try{yield this.userService.addToCleanerAccount(t,d),console.log(`Credited R${d} to cleaner's account`),yield this.availableJobsService.markJobAsFinalized(this.jobId)}catch(c){console.error("Error finalizing service or crediting cleaner:",c)}}})}get shouldOnlyReview(){return!!(this.role==="user"&&this.userConfirmed||this.role==="service-provider"&&this.cleanerConfirmed)}get canReview(){return this.shouldOnlyReview}openReviewModal(){return g(this,null,function*(){let a=this.role==="user"?this.job.cleanerID:this.job.userId,l=yield this.modalController.create({component:fe,componentProps:{jobId:this.jobId,role:this.role,recipientId:a},breakpoints:[0,.5,.8],initialBreakpoint:.5});yield l.present();let{data:t,role:d}=yield l.onDidDismiss();d==="submit"&&console.log("Review submitted:",t)})}};s.\u0275fac=function(l){return new(l||s)(h(j),h(H),h(ge),h(K),h(Q))},s.\u0275cmp=_({type:s,selectors:[["app-view-service"]],decls:76,vars:22,consts:[["defaultAvatar",""],[4,"ngIf"],[3,"fullscreen"],[1,"p-4"],[1,"mb-4","shadow-md","rounded-2xl"],[1,"text-lg","font-semibold","text-gray-800"],[1,"space-y-4"],[1,"flex","items-center","gap-4"],["alt","Profile","class","w-16 h-16 rounded-full border-2 border-primary",3,"src",4,"ngIf","ngIfElse"],[1,"text-sm","text-gray-700"],["expand","block","color","primary",1,"mt-2","shadow-md",3,"click"],[1,"bg-white","rounded-2xl","shadow-md","p-6","space-y-6"],[1,"text-center","text-xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-700","space-y-1"],["class","text-sm text-red-700",4,"ngIf"],[1,"text-sm","text-blue-700"],[1,"flex","flex-col","md:flex-row","gap-4"],[1,"w-full","bg-red-600","hover:bg-red-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"click","disabled"],[1,"w-full","bg-yellow-600","hover:bg-yellow-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"disabled"],["color","success",3,"click","disabled"],["class","w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 rounded-lg text-sm shadow transition",3,"click",4,"ngIf"],["slot","start"],["alt","Profile",1,"w-16","h-16","rounded-full","border-2","border-primary",3,"src"],[1,"w-16","h-16","bg-gray-300","rounded-full","flex","items-center","justify-center","text-white","text-lg"],["name","person-outline"],[1,"text-sm","text-red-700"],[1,"list-disc","list-inside","text-sm","text-gray-700","space-y-1"],[4,"ngFor","ngForOf"],[1,"w-full","bg-indigo-600","hover:bg-indigo-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"click"]],template:function(l,t){if(l&1){let d=P();f(0,Ie,6,0,"ion-header",1),n(1,"ion-content",2),w(2,"app-global-background"),n(3,"div",3)(4,"ion-card",4)(5,"ion-card-header")(6,"ion-card-title",5),i(7),e()(),n(8,"ion-card-content",6)(9,"div",7),f(10,ye,1,1,"img",8)(11,xe,2,0,"ng-template",null,0,W),n(13,"div")(14,"p",9)(15,"strong"),i(16,"Name:"),e(),i(17),e(),n(18,"p",9)(19,"strong"),i(20,"Email:"),e(),i(21),e()()(),n(22,"ion-button",10),v("click",function(){return y(d),x(t.startChat(t.otherPartyInfo))}),i(23," Start Chat "),e()()(),n(24,"div",11)(25,"h2",12),i(26," Details About Your Clean "),e(),n(27,"div",13)(28,"p")(29,"strong"),i(30,"Service:"),e(),i(31),e(),n(32,"p")(33,"strong"),i(34,"Preferred Date:"),e(),i(35),e(),n(36,"p")(37,"strong"),i(38,"Offered Rate:"),e(),i(39),e()(),n(40,"div",9)(41,"p")(42,"strong"),i(43,"Location:"),e(),i(44," Randpark, Randburg"),e()(),n(45,"div",9)(46,"p")(47,"strong"),i(48,"Booking Type:"),e(),i(49),e()(),f(50,we,5,1,"div",14)(51,_e,5,1,"div",14)(52,Se,5,1,"div",14),n(53,"div",9)(54,"p")(55,"strong"),i(56,"Scheduled Date:"),e(),i(57),e(),n(58,"p")(59,"strong"),i(60,"Scheduled Time:"),e(),i(61),e()(),f(62,Ee,5,1,"div",1),n(63,"div")(64,"h3",5),i(65," Additional Instructions "),e(),n(66,"p",15),i(67),e()(),n(68,"div",16)(69,"button",17),v("click",function(){return y(d),x(t.backtoDash())}),i(70," Decline "),e(),n(71,"button",18),i(72," Cancel "),e(),n(73,"ion-button",19),v("click",function(){return y(d),x(t.markServiceComplete())}),i(74," Mark Service as Completed "),e(),f(75,ke,2,0,"button",20),e()()()()}if(l&2){let d=L(12);m("ngIf",!t.isUpcomingJob),r(),m("fullscreen",!0),r(6),p(" ",t.role==="service-provider"?"Client":"Cleaner"," Info "),r(3),m("ngIf",t.otherPartyInfo==null?null:t.otherPartyInfo.photoURL)("ngIfElse",d),r(7),p(" ",(t.otherPartyInfo==null?null:t.otherPartyInfo.displayName)||"N/A"," "),r(4),p(" ",(t.otherPartyInfo==null?null:t.otherPartyInfo.email)||"N/A"," "),r(10),p(" ",t.jobType,""),r(4),p(" ",t.scheduledDate,""),r(4),p(" R",t.price,""),r(10),p(" ",t.bookingType,""),r(),m("ngIf",t.bookingType==="Re-occurring"&&t.bookingFrequency),r(),m("ngIf",t.bookingType==="Re-occurring"&&t.recurringDate),r(),m("ngIf",t.bookingType==="Re-occurring"&&t.recurringDay),r(5),p(" ",t.scheduledDateOnly,""),r(4),p(" ",t.scheduledTimeOnly,""),r(),m("ngIf",t.jobItems==null?null:t.jobItems.length),r(5),V(t.additionalInfo),r(2),m("disabled",t.shouldOnlyReview),r(2),m("disabled",t.shouldOnlyReview),r(2),m("disabled",t.shouldOnlyReview),r(2),m("ngIf",t.canReview)}},dependencies:[T,E,ee,te,ie,ne,oe,k,re,ae,de,ue,pe,S,z,q,C,$],encapsulation:2});let o=s;return o})();export{qe as ViewtServicePage};
