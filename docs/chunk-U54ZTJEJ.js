import{a as X}from"./chunk-XWTMKH22.js";import{a as Y}from"./chunk-RFC543RR.js";import"./chunk-GJRON2FT.js";import{f as J,k as K,o as Q}from"./chunk-L2HEO6U7.js";import{F as q}from"./chunk-JYJCGWMW.js";import{E as V,F as z,G,J as W,b as j,g as A,j as B,t as O,u as P,v as R,w as $,x as H}from"./chunk-RADV76JZ.js";import{Ga as U,Ja as M,L as I,La as E,M as _,U as y,Ua as D,V as l,Va as T,W as u,Wa as L,Y as v,Za as k,aa as f,ab as w,ea as c,ga as o,gb as N,ha as a,ia as d,ic as F,ma as C,na as b,oa as p,xa as h,ya as S,za as x}from"./chunk-KV6L2PIJ.js";import"./chunk-A2PWH3LV.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{g as m}from"./chunk-OLRFWS6T.js";var Z=n=>({"text-blue-400":n});function tt(n,r){if(n&1){let e=C();o(0,"ion-item",8),b("click",function(){let i=I(e).$implicit,s=p(2);return _(s.openChat(i))}),o(1,"ion-avatar",1),d(2,"img",9),a(),o(3,"ion-label",10)(4,"h2",11),h(5),a(),o(6,"div",12)(7,"p",13),h(8),a(),o(9,"span",14),h(10),M(11,"date"),a()()()()}if(n&2){let e=r.$implicit,t=p(2);c("detail",!0),l(2),c("src",(e==null||e.otherUser==null?null:e.otherUser.photoURL)||"assets/default-avatar.png",y),l(3),S(e==null||e.otherUser==null?null:e.otherUser.displayName),l(2),c("ngClass",U(9,Z,(e==null?null:e.lastMessage)&&(e==null?null:e.senderId)!==t.userID)),l(),x(" ",(e==null?null:e.lastMessage)||"No message"," "),l(2),x(" ",e!=null&&e.timestamp?E(11,6,e==null?null:e.timestamp,"shortTime"):""," ")}}function et(n,r){if(n&1&&(o(0,"ion-list")(1,"ion-list-header",6),h(2," RECENT CHATS "),a(),f(3,tt,12,11,"ion-item",7),a()),n&2){let e=p();l(3),c("ngForOf",e.chatList)}}function it(n,r){n&1&&(o(0,"ion-text",15),h(1,` No chats yet. Start a conversation!
`),a())}var pt=(()=>{let r=class r{constructor(t,i,s,g){this.router=t,this.chatService=i,this.auth=s,this.firestore=g,this.chatUsers=[],this.isLoading=!0,this.user=null,this.otherUser=null,this.chatList=[],this.lastMessage=[]}ngOnInit(){return m(this,null,function*(){this.auth.onAuthStateChanged(t=>{t&&(this.user=t,this.userID=t.uid,this.chatSubscription=this.chatService.listenToUserChats(this.userID).subscribe(i=>{this.chatList=i}))}),this.loadChatUsers()})}ngOnDestroy(){this.chatSubscription&&this.chatSubscription.unsubscribe()}loadChatUsers(){return m(this,null,function*(){try{this.isLoading=!0,this.auth.onAuthStateChanged(t=>m(this,null,function*(){if(t){this.user=t,this.userID=t.uid,this.chatUsers=yield this.chatService.getUsersChattedWith(this.userID);for(let i of this.chatUsers){let s=yield this.chatService.getLastMessage(i.id);i.lastMessage=s||{text:"No message",timestamp:null}}}else console.log("No user is logged in.")}))}catch(t){console.error("Error loading chat users: ",t)}finally{this.isLoading=!1}})}openChat(t){console.log(t),this.user&&this.router.navigate([`/chat/${this.user.uid}-${t.otherUserId}`])}listChatCollections(){return m(this,null,function*(){let t=K(this.firestore,"chats"),i=yield Q(t);console.log(i);let s=[];i.forEach(g=>{s.push(g.id)}),console.log("Chat IDs:",s)})}};r.\u0275fac=function(i){return new(i||r)(u(N),u(Y),u(q),u(J))},r.\u0275cmp=v({type:r,selectors:[["app-messenger"]],decls:11,vars:2,consts:[["color","dark"],["slot","start"],["slot","end"],["slot","icon-only","name","information-circle-outline"],[4,"ngIf"],["class","ion-padding text-center text-gray-500",4,"ngIf"],["color","Dark",1,"ion-padding-bottom"],["class","bg-gray-800 rounded-lg my-2 p-4",3,"detail","click",4,"ngFor","ngForOf"],[1,"bg-gray-800","rounded-lg","my-2","p-4",3,"click","detail"],[3,"src"],[1,"text-white"],[1,"font-semibold"],[1,"flex","justify-between","items-center"],[1,"text-sm","text-gray-400","truncate",3,"ngClass"],[1,"text-xs","text-gray-500"],[1,"ion-padding","text-center","text-gray-500"]],template:function(i,s){i&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),d(3,"ion-back-button"),a(),o(4,"ion-title"),h(5,"Messenger"),a(),o(6,"ion-buttons",2),d(7,"ion-icon",3),a()()(),d(8,"app-global-background"),f(9,et,4,1,"ion-list",4)(10,it,2,0,"ion-text",5)),i&2&&(l(9),c("ngIf",s.chatUsers.length>0),l(),c("ngIf",s.chatUsers.length===0))},dependencies:[H,V,R,A,P,$,j,B,O,z,G,w,D,T,L,k,F,W,X],encapsulation:2});let n=r;return n})();export{pt as MessengerPage};
