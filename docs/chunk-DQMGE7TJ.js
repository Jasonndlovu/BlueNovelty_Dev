import{a as ve}from"./chunk-FYLT2MHV.js";import{a as fe}from"./chunk-J43YLG5W.js";import{A as ge,D as F,F as N,a as ee,c as te,e as A,f as ie,g as ne,h as oe,i as re,k as ae,l as O,o as le,p as se,r as de,s as ce,u as me,v as pe,y as ue,z as he}from"./chunk-62ROZ2JN.js";import"./chunk-36AM222O.js";import"./chunk-7QQQ4XSS.js";import"./chunk-E66F5ZP3.js";import"./chunk-HC6MZPB3.js";import"./chunk-2SDYHWHI.js";import"./chunk-4PGTP63H.js";import"./chunk-FW7FQTSR.js";import"./chunk-FERD25SW.js";import"./chunk-HMTYJH34.js";import"./chunk-VFZRLGVJ.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-C5FLGXKQ.js";import"./chunk-Q7SJDITE.js";import"./chunk-MCRJI3T3.js";import"./chunk-MM5QLNJM.js";import"./chunk-NHOGAROI.js";import"./chunk-72KDLSWN.js";import{a as X}from"./chunk-XWTMKH22.js";import{a as Z}from"./chunk-B2FOGW6Z.js";import"./chunk-L2HEO6U7.js";import{F as Q}from"./chunk-JYJCGWMW.js";import{Aa as q,Ba as C,Ca as E,Da as k,L as I,M as _,Na as H,Sb as $,U as L,V as l,Va as Y,W as g,Wa as G,Wb as V,Y as T,Zb as R,aa as f,ab as D,ea as m,ga as n,gb as K,ha as e,ia as S,ic as P,ma as j,na as v,oa as h,wa as z,xa as i,ya as M,za as u}from"./chunk-KV6L2PIJ.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-LF5XB4YN.js";import{g as x}from"./chunk-OLRFWS6T.js";var be=(()=>{let s=class s{constructor(r,a){this.modalCtrl=r,this.reviewService=a,this.message="",this.rating=5}ngOnInit(){}addReview(){return x(this,null,function*(){try{let r=yield this.reviewService.addReview(this.jobId,this.message,this.rating,this.recipientId);console.log("Review added:",r),this.modalCtrl.dismiss({submitted:!0},"submit")}catch(r){console.error("Error adding review:",r)}})}closeModal(){this.modalCtrl.dismiss(null,"cancel")}};s.\u0275fac=function(a){return new(a||s)(g(F),g(fe))},s.\u0275cmp=T({type:s,selectors:[["app-review-modal"]],inputs:{serviceId:"serviceId",jobId:"jobId",role:"role",recipientId:"recipientId"},decls:15,vars:2,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModelChange","ngModel"],["min","1","max","5","step","1","snaps","","pin","",3,"ngModelChange","ngModel"],["slot","start"],["slot","end"],["color","dark",3,"click"]],template:function(a,t){a&1&&(n(0,"ion-content",0)(1,"ion-item")(2,"ion-label",1),i(3,"Your Feedback"),e(),n(4,"ion-textarea",2),k("ngModelChange",function(p){return E(t.message,p)||(t.message=p),p}),e()(),n(5,"ion-item")(6,"ion-label"),i(7,"Rating"),e(),n(8,"ion-range",3),k("ngModelChange",function(p){return E(t.rating,p)||(t.rating=p),p}),n(9,"ion-label",4),i(10,"1"),e(),n(11,"ion-label",5),i(12,"5"),e()()(),n(13,"ion-button",6),v("click",function(){return t.addReview()}),i(14,"Submit"),e()()),a&2&&(l(4),C("ngModel",t.message),l(4),C("ngModel",t.rating))},dependencies:[D,P,V,R,N,A,O,de,ce,pe,ue,ee,te],encapsulation:2});let o=s;return o})();function ye(o,s){o&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",23),S(3,"ion-menu-button"),e(),n(4,"ion-title"),i(5,"View Service"),e()()())}function we(o,s){if(o&1&&S(0,"img",24),o&2){let d=h();m("src",d.otherPartyInfo.photoURL,L)}}function Se(o,s){o&1&&(n(0,"div",25),S(1,"ion-icon",26),e())}function Ce(o,s){if(o&1&&(n(0,"li"),i(1),e()),o&2){let d,r=s.$implicit;l(),q(" ",r.split("T")[0]," at ",(d=r.split("T")[1])==null?null:d.slice(0,5)," ")}}function Ee(o,s){if(o&1&&(n(0,"div",27)(1,"p")(2,"strong"),i(3,"Booking frequency:"),e(),i(4),e()()),o&2){let d=h();l(4),u(" ",d.bookingFrequency,"")}}function ke(o,s){if(o&1&&(n(0,"div",27)(1,"p")(2,"strong"),i(3,"Booking day of the month:"),e(),i(4),e()()),o&2){let d=h();l(4),u(" ",d.recurringDate,"th")}}function Te(o,s){if(o&1&&(n(0,"div",27)(1,"p")(2,"strong"),i(3,"Every:"),e(),i(4),e()()),o&2){let d=h();l(4),u(" ",d.recurringDay,"")}}function je(o,s){if(o&1&&(n(0,"li"),i(1),e()),o&2){let d=s.$implicit;l(),M(d)}}function Me(o,s){if(o&1&&(n(0,"div")(1,"h3",5),i(2,"Extras"),e(),n(3,"ul",28),f(4,je,2,1,"li",15),e()()),o&2){let d=h();l(4),m("ngForOf",d.jobItems)}}function De(o,s){if(o&1){let d=j();n(0,"label",31)(1,"input",32),k("ngModelChange",function(a){let t=I(d).index,c=h(2);return E(c.checkedItems[t],a)||(c.checkedItems[t]=a),_(a)}),v("change",function(){I(d);let a=h(2);return _(a.checkCompletion())}),e(),n(2,"span"),i(3),e()()}if(o&2){let d=s.$implicit,r=s.index,a=h(2);l(),C("ngModel",a.checkedItems[r]),l(2),M(d)}}function Ve(o,s){if(o&1&&(n(0,"div")(1,"h3",5),i(2,"Checklist"),e(),n(3,"div",29),f(4,De,4,2,"label",30),e()()),o&2){let d=h();l(4),m("ngForOf",d.jobItems)}}function Re(o,s){if(o&1){let d=j();n(0,"button",33),v("click",function(){I(d);let a=h();return _(a.openReviewModal())}),i(1," Add Review "),e()}}var $e=(()=>{let s=class s{constructor(r,a,t,c,p){var J,W;this.modalController=r,this.router=a,this.availableJobsService=t,this.auth=c,this.userService=p,this.user=null,this.isUpcomingJob=!1,this.checkedItems=[],this.canMarkComplete=!1,this.scheduledDates=[],this.editMode=!1,this.role="user";let B=this.router.getCurrentNavigation(),y=(J=B==null?void 0:B.extras)==null?void 0:J.state;if(y){console.log(y),this.job=y.job,this.editMode=y.editMode,this.role=y.role,console.log(this.job),this.jobId=this.job.id,this.jobType=this.job.serviceType,this.userId=this.job.userId,this.price=this.job.totalCostToUser,this.additionalInfo=this.job.additionalInfo,this.bookingType=this.job.bookingType,this.scheduledDates=Array.isArray(this.job.selectedTimeAndDate)?this.job.selectedTimeAndDate:this.job.selectedTimeAndDate?[this.job.selectedTimeAndDate]:[],this.userConfirmed=this.job.userConfirmed,this.cleanerConfirmed=(W=this.job)==null?void 0:W.cleanerConfirmed,this.bookingFrequency=this.job.recurringOption||"None",this.recurringDay=this.job.recurringDay||"N/A",this.recurringDate=this.job.recurringDate||"N/A";let U=this.job.selectedExtras;if(this.jobItems=U?U.split(",").map(w=>w.trim()):[],this.scheduledDates.length>0){this.scheduledDate=this.scheduledDates[0];let[w,b]=this.scheduledDate.split("T");this.scheduledDateOnly=w,this.scheduledTimeOnly=b==null?void 0:b.slice(0,5)}if(this.scheduledDate){let[w,b]=this.scheduledDate.split("T");this.scheduledDateOnly=w,this.scheduledTimeOnly=b==null?void 0:b.slice(0,5)}}else console.warn("No state data found. Redirecting back."),this.router.navigate(["/upcoming-jobs"])}ngOnInit(){this.checkedItems=this.jobItems.map(()=>!1),this.auth.onAuthStateChanged(a=>x(this,null,function*(){this.user=a}));let r=this.role==="user"?this.job.cleanerID:this.job.userId;this.userService.getUserById(r).subscribe(a=>{this.otherPartyInfo=a},a=>{console.error("Error loading user:",a)})}backtoDash(){this.router.navigate(["/dashboard"])}startChat(r){this.user&&this.router.navigate([`/chat/${this.user.uid}-${r.uid}`])}markServiceComplete(){return x(this,null,function*(){if(!this.user||!this.jobId)return;let r=this.role==="service-provider"?"cleanerConfirmed":"userConfirmed";try{yield this.availableJobsService.updateJobConfirmation(this.jobId,r,!0),console.log(`${r} set to true`),this.checkAndFinalizeServiceCompletion(),this.backtoDash()}catch(a){console.error("Error updating confirmation:",a)}})}checkAndFinalizeServiceCompletion(){return x(this,null,function*(){let r=yield this.availableJobsService.getJobById(this.jobId);if((r==null?void 0:r.cleanerConfirmed)&&(r==null?void 0:r.userConfirmed)){let t=this.job.cleanerID,c=Math.round((this.price||0)*.9);try{yield this.userService.addToCleanerAccount(t,c),console.log(`Credited R${c} to cleaner's account`),yield this.availableJobsService.markJobAsFinalized(this.jobId)}catch(p){console.error("Error finalizing service or crediting cleaner:",p)}}})}get shouldOnlyReview(){return!!(this.role==="user"&&this.userConfirmed||this.role==="service-provider"&&this.cleanerConfirmed)}get canReview(){return this.shouldOnlyReview}openReviewModal(){return x(this,null,function*(){let r=this.role==="user"?this.job.cleanerID:this.job.userId,a=yield this.modalController.create({component:be,componentProps:{jobId:this.jobId,role:this.role,recipientId:r},breakpoints:[0,.5,.8],initialBreakpoint:.5});yield a.present();let{data:t,role:c}=yield a.onDidDismiss();c==="submit"&&console.log("Review submitted:",t)})}checkCompletion(){this.canMarkComplete=this.checkedItems.every(r=>r===!0)}};s.\u0275fac=function(a){return new(a||s)(g(F),g(K),g(ve),g(Q),g(Z))},s.\u0275cmp=T({type:s,selectors:[["app-view-service"]],decls:78,vars:23,consts:[["defaultAvatar",""],[4,"ngIf"],[3,"fullscreen"],[1,"p-4"],[1,"mb-4","shadow-md","rounded-2xl"],[1,"text-lg","font-semibold","text-gray-800"],[1,"space-y-4"],[1,"flex","items-center","gap-4"],["alt","Profile","class","w-16 h-16 rounded-full border-2 border-primary",3,"src",4,"ngIf","ngIfElse"],[1,"text-sm","text-gray-700"],["expand","block","color","primary",1,"mt-2","shadow-md",3,"click"],[1,"bg-white","rounded-2xl","shadow-md","p-6","space-y-6"],[1,"text-center","text-xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-700","space-y-1"],[1,"ml-4","list-disc"],[4,"ngFor","ngForOf"],["class","text-sm text-red-700",4,"ngIf"],[1,"text-sm","text-blue-700"],[1,"flex","flex-col","md:flex-row","gap-4"],[1,"w-full","bg-red-600","hover:bg-red-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"click","disabled"],[1,"w-full","bg-yellow-600","hover:bg-yellow-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"disabled"],["color","success",3,"click","disabled"],["class","w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 rounded-lg text-sm shadow transition",3,"click",4,"ngIf"],["slot","start"],["alt","Profile",1,"w-16","h-16","rounded-full","border-2","border-primary",3,"src"],[1,"w-16","h-16","bg-gray-300","rounded-full","flex","items-center","justify-center","text-white","text-lg"],["name","person-outline"],[1,"text-sm","text-red-700"],[1,"list-disc","list-inside","text-sm","text-gray-700","space-y-1"],[1,"space-y-2"],["class","flex items-center space-x-2 text-sm text-gray-700",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-2","text-sm","text-gray-700"],["type","checkbox",1,"form-checkbox","text-indigo-600","w-4","h-4","rounded",3,"ngModelChange","change","ngModel"],[1,"w-full","bg-indigo-600","hover:bg-indigo-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"click"]],template:function(a,t){if(a&1){let c=j();f(0,ye,6,0,"ion-header",1),n(1,"ion-content",2),S(2,"app-global-background"),n(3,"div",3)(4,"ion-card",4)(5,"ion-card-header")(6,"ion-card-title",5),i(7),e()(),n(8,"ion-card-content",6)(9,"div",7),f(10,we,1,1,"img",8)(11,Se,2,0,"ng-template",null,0,H),n(13,"div")(14,"p",9)(15,"strong"),i(16,"Name:"),e(),i(17),e(),n(18,"p",9)(19,"strong"),i(20,"Email:"),e(),i(21),e()()(),n(22,"ion-button",10),v("click",function(){return I(c),_(t.startChat(t.otherPartyInfo))}),i(23," Start Chat "),e()()(),n(24,"div",11)(25,"h2",12),i(26," Details About Your Clean "),e(),n(27,"div",13)(28,"p")(29,"strong"),i(30,"Service:"),e(),i(31),e(),n(32,"p")(33,"strong"),i(34,"Preferred Dates:"),e()(),n(35,"ul",14),f(36,Ce,2,2,"li",15),e(),n(37,"p")(38,"strong"),i(39,"Offered Rate:"),e(),i(40),e()(),n(41,"div",9)(42,"p")(43,"strong"),i(44,"Location:"),e(),i(45," Randpark, Randburg"),e()(),n(46,"div",9)(47,"p")(48,"strong"),i(49,"Booking Type:"),e(),i(50),e()(),f(51,Ee,5,1,"div",16)(52,ke,5,1,"div",16)(53,Te,5,1,"div",16),n(54,"div",9)(55,"p")(56,"strong"),i(57,"Scheduled Date:"),e(),i(58),e(),n(59,"p")(60,"strong"),i(61,"Scheduled Time:"),e(),i(62),e()(),f(63,Me,5,1,"div",1)(64,Ve,5,1,"div",1),n(65,"div")(66,"h3",5),i(67," Additional Instructions "),e(),n(68,"p",17),i(69),e()(),n(70,"div",18)(71,"button",19),v("click",function(){return I(c),_(t.backtoDash())}),i(72," Decline "),e(),n(73,"button",20),i(74," Cancel "),e(),n(75,"ion-button",21),v("click",function(){return I(c),_(t.markServiceComplete())}),i(76," Mark Service as Completed "),e(),f(77,Re,2,0,"button",22),e()()()()}if(a&2){let c=z(12);m("ngIf",!t.isUpcomingJob),l(),m("fullscreen",!0),l(6),u(" ",t.role==="service-provider"?"Client":"Cleaner"," Info "),l(3),m("ngIf",t.otherPartyInfo==null?null:t.otherPartyInfo.photoURL)("ngIfElse",c),l(7),u(" ",(t.otherPartyInfo==null?null:t.otherPartyInfo.displayName)||"N/A"," "),l(4),u(" ",(t.otherPartyInfo==null?null:t.otherPartyInfo.email)||"N/A"," "),l(10),u(" ",t.jobType,""),l(5),m("ngForOf",t.scheduledDates),l(4),u(" R",t.price,""),l(10),u(" ",t.bookingType,""),l(),m("ngIf",t.bookingType==="Re-occurring"&&t.bookingFrequency),l(),m("ngIf",t.bookingType==="Re-occurring"&&t.recurringDate),l(),m("ngIf",t.bookingType==="Re-occurring"&&t.recurringDay),l(5),u(" ",t.scheduledDateOnly,""),l(4),u(" ",t.scheduledTimeOnly,""),l(),m("ngIf",t.jobItems==null?null:t.jobItems.length),l(),m("ngIf",t.jobItems==null?null:t.jobItems.length),l(5),M(t.additionalInfo),l(2),m("disabled",t.shouldOnlyReview),l(2),m("disabled",t.shouldOnlyReview),l(2),m("disabled",t.shouldOnlyReview||!t.canMarkComplete),l(2),m("ngIf",t.canReview)}},dependencies:[N,A,ie,ne,oe,re,ae,O,le,se,me,he,ge,D,Y,G,P,$,V,R,X],encapsulation:2});let o=s;return o})();export{$e as ViewtServicePage};
