import{a as oe}from"./chunk-YCA6ITIU.js";import{c as te,j as ie,k as ne}from"./chunk-6CACEU2V.js";import{F as ee}from"./chunk-ZGICK3R3.js";import{C as K,E as Q,H as W,I as X,L as Y,h as R,i as z,k as N,l as O,m as U,o as k,p as M,q as V,s as $,t as G,u as J,v as Z,w as q}from"./chunk-C2NQIB3Y.js";import{$a as _,Aa as l,Ba as x,Ca as v,Ha as P,L as H,La as T,M as w,Oa as j,V as s,W as g,Xa as A,Y as C,Ya as L,aa as h,bb as B,cb as F,ea as d,ja as n,ka as a,la as m,pa as D,qa as E,ra as u}from"./chunk-RFSKJ54S.js";import"./chunk-A2PWH3LV.js";import"./chunk-7KGURMOZ.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{g as b}from"./chunk-OLRFWS6T.js";function re(e,c){e&1&&(n(0,"div",2),m(1,"ion-spinner",3),n(2,"p"),l(3,"Loading service history..."),a()())}function se(e,c){if(e&1){let i=D();n(0,"div",2),m(1,"ion-icon",4),n(2,"p"),l(3),a(),n(4,"ion-button",5),E("click",function(){H(i);let o=u();return w(o.loadServiceHistory())}),m(5,"ion-icon",6),l(6," Try Again "),a()()}if(e&2){let i=u();s(3),x(i.error)}}function ae(e,c){e&1&&(n(0,"div",2),m(1,"ion-icon",7),n(2,"p"),l(3,"No service history found"),a()())}function ce(e,c){if(e&1&&(n(0,"ion-row")(1,"ion-col",10)(2,"ion-label"),m(3,"ion-icon",13),l(4),a()()()),e&2){let i=u().$implicit;s(4),v(" ",i.selectedProperty.name," ")}}function le(e,c){if(e&1&&(n(0,"ion-row")(1,"ion-col",10)(2,"ion-label"),m(3,"ion-icon",14),l(4),a()()()),e&2){let i=u().$implicit;s(4),v(" ",i.additionalInfo," ")}}function de(e,c){if(e&1&&(n(0,"ion-item")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),l(4),a(),n(5,"ion-badge",9),l(6),a()(),n(7,"ion-card-content")(8,"ion-grid")(9,"ion-row")(10,"ion-col",10)(11,"ion-label"),m(12,"ion-icon",11),l(13),a()()(),n(14,"ion-row")(15,"ion-col",10)(16,"ion-label"),m(17,"ion-icon",12),l(18),T(19,"currency"),a()()(),h(20,ce,5,1,"ion-row",1)(21,le,5,1,"ion-row",1),a()()()()),e&2){let i=c.$implicit,t=u(2);s(4),x(i.serviceType||"Service"),s(),d("color",i.serviceStatus==="Completed"?"success":"warning"),s(),v(" ",i.serviceStatus," "),s(7),v(" ",t.formatDate(i.createdAt)," "),s(5),v(" ",j(19,7,i.totalCostToUser,"ZAR","symbol-narrow")," "),s(2),d("ngIf",i.selectedProperty==null?null:i.selectedProperty.name),s(),d("ngIf",i.additionalInfo)}}function me(e,c){if(e&1&&(n(0,"ion-list"),h(1,de,22,11,"ion-item",8),a()),e&2){let i=u();s(),d("ngForOf",i.serviceHistory)}}var Ie=(()=>{let c=class c{constructor(t,o,r,p){this.jobsService=t,this.datePipe=o,this.auth=r,this.firestore=p,this.serviceHistory=[],this.isLoading=!0,this.error=null,this.userRole=null,this.userId=null}ngOnInit(){this.loadServiceHistory()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}loadServiceHistory(){return b(this,null,function*(){let t=this.auth.currentUser;if(!t){console.warn("User not logged in."),this.isLoading=!1;return}this.userId=t.uid;let o=ie(this.firestore,"users",t.uid),r=yield ne(o);if(r.exists()){let p=r.data();this.userRole=p.role}else{console.warn("User data not found."),this.isLoading=!1;return}this.isLoading=!0,this.error=null,this.jobsService.getServiceHistoryByStatus("Completed").subscribe({next:p=>{this.jobsService.getServiceHistoryByStatus("Cancelled").subscribe({next:y=>{this.jobsService.getServiceHistoryByStatus("finalized").subscribe({next:I=>{let f=[...p,...y,...I];console.log(f),this.userRole==="user"?f=f.filter(S=>S.userId===this.userId):this.userRole==="service-provider"&&(f=f.filter(S=>S.cleanerID===this.userId)),this.serviceHistory=f,this.sortByDate(),this.isLoading=!1},error:I=>{console.error("Error fetching finalized jobs:",I),this.error="Failed to load finalized jobs",this.isLoading=!1}})},error:y=>{console.error("Error fetching cancelled jobs:",y),this.error="Failed to load cancelled jobs",this.isLoading=!1}})},error:p=>{console.error("Error fetching completed jobs:",p),this.error="Failed to load completed jobs",this.isLoading=!1}})})}sortByDate(){this.serviceHistory.sort((t,o)=>{let r=t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt);return(o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)).getTime()-r.getTime()})}formatDate(t){if(!t)return"N/A";try{let o=t instanceof Date?t:new Date(t);return this.datePipe.transform(o,"mediumDate")||"N/A"}catch{return"N/A"}}};c.\u0275fac=function(o){return new(o||c)(g(oe),g(_),g(ee),g(te))},c.\u0275cmp=C({type:c,selectors:[["app-service-history"]],features:[P([_])],decls:9,vars:4,consts:[["class","ion-text-center ion-padding",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-padding"],["name","crescent"],["name","warning","size","large"],["fill","clear",3,"click"],["slot","start","name","refresh"],["name","time-outline","size","large"],[4,"ngFor","ngForOf"],[3,"color"],["size","12"],["name","calendar-outline","slot","start"],["name","cash-outline","slot","start"],["name","home-outline","slot","start"],["name","document-text-outline","slot","start"]],template:function(o,r){o&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),l(3,"Service History"),a()()(),n(4,"ion-content"),h(5,re,4,0,"div",0)(6,se,7,1,"div",0)(7,ae,4,0,"div",0)(8,me,2,1,"ion-list",1),a()),o&2&&(s(5),d("ngIf",r.isLoading),s(),d("ngIf",!r.isLoading&&r.error),s(),d("ngIf",!r.isLoading&&!r.error&&r.serviceHistory.length===0),s(),d("ngIf",!r.isLoading&&!r.error&&r.serviceHistory.length>0))},dependencies:[$,M,K,z,Y,F,A,L,B,G,X,W,V,q,J,N,U,k,O,Z,R,Q],encapsulation:2});let e=c;return e})();export{Ie as ServiceHistoryPage};
