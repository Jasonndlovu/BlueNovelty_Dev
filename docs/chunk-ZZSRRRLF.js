import{c as P,j as u,k as c,r as w}from"./chunk-6CACEU2V.js";import{B as E,C as S,D as v,E as U,F as N,I as d,K as I,M as R,N as b,O as f}from"./chunk-ZGICK3R3.js";import{B as y,F as p,c as n}from"./chunk-RFSKJ54S.js";import{g as o}from"./chunk-OLRFWS6T.js";var j=(()=>{let a=class a{constructor(){this.auth=p(N),this.firestore=p(P),this.userEmail=new n(null),this.userName=new n(null),this.userRole=new n(null),this.userEmail$=this.userEmail.asObservable(),this.userName$=this.userName.asObservable(),this.userRole$=this.userRole.asObservable()}loginWithGoogle(){return o(this,null,function*(){let r=new S,e=yield f(this.auth,r);return e.user&&(yield this.saveUserData(e.user)),e})}loginWithApple(){return o(this,null,function*(){let r=new E("apple.com"),e=yield f(this.auth,r);return e.user&&(yield this.saveUserData(e.user)),e})}loginWithEmail(r,e){return o(this,null,function*(){try{let s=yield b(this.auth,r,e);return s.user&&(yield this.saveUserData(s.user)),s}catch(s){throw console.error("Error logging in with email and password:",s),s}})}sendPasswordResetEmail(r){return o(this,null,function*(){try{return yield R(this.auth,r),!0}catch(e){throw console.error("Error sending password reset email:",e),e}})}saveUserData(r,e,s){return o(this,null,function*(){let t=u(this.firestore,`users/${r.uid}`),i=yield c(t);if(s!=!0&&(s=!1),!i.exists()){let h=localStorage.getItem("userRole"),l=r.displayName||`${e==null?void 0:e.name} ${e==null?void 0:e.surname}`,g=r.email||"";if(console.log("Role:",h),console.log("Display Name:",l),console.log("Email:",g),!h)throw new Error("Role not found in local storage");yield w(t,{uid:r.uid,displayName:l,email:g,photoURL:r.photoURL||"",role:h,phoneNumber:(e==null?void 0:e.phone)||"",createdAt:new Date}),s&&this.updateUserProfile(l),console.log("Saving to localStorage..."),localStorage.setItem("userEmail",g),localStorage.setItem("userName",l),console.log("Saved:",localStorage.getItem("userEmail"),localStorage.getItem("userName"))}})}updateUserProfile(r){return o(this,null,function*(){var e=U();if(e.currentUser)try{yield v(e.currentUser,{displayName:r}),console.log("Display Name Updated:",e.currentUser.displayName)}catch(s){console.error("Error updating display name:",s)}else console.log("No user is signed in.")})}logout(){return o(this,null,function*(){try{yield this.auth.signOut(),this.clearLocalStorage()}catch(r){console.error("Error logging out:",r)}})}clearLocalStorage(){localStorage.removeItem("userEmail"),localStorage.removeItem("userName"),localStorage.removeItem("userRole"),sessionStorage.clear()}getCurrentUser(){return d(this.auth)}loadUserFromStorage(){let r=localStorage.getItem("userEmail"),e=localStorage.getItem("userName");r&&this.userEmail.next(r),e&&this.userName.next(e)}getUserRole(r){return o(this,null,function*(){var t;let e=u(this.firestore,`users/${r}`),s=yield c(e);return s.exists()&&((t=s.data())==null?void 0:t.role)||null})}setUserRole(r){return o(this,null,function*(){var i;let e=this.auth.currentUser;if(!e)return;let s=u(this.firestore,`users/${e.uid}`),t=yield c(s);(!t.exists()||!((i=t.data())!=null&&i.role))&&(yield w(s,{role:r},{merge:!0}),localStorage.setItem("userRole",r),this.userRole.next(r))})}registerWithEmail(r,e,s){return o(this,null,function*(){try{let i=(yield I(this.auth,r,e)).user;return yield this.saveUserData(i,s,!0),i}catch(t){throw console.error("Error registering user:",t),t}})}};a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=y({token:a,factory:a.\u0275fac,providedIn:"root"});let m=a;return m})();export{j as a};
