import{a as ve}from"./chunk-YCA6ITIU.js";import{a as fe}from"./chunk-B7JSY7TB.js";import{B as E,D as ge,a as le,c as se,e as de,l as ce,q as me,r as ue,u as pe,x as he}from"./chunk-IMIFORWP.js";import"./chunk-36AM222O.js";import"./chunk-7QQQ4XSS.js";import"./chunk-E66F5ZP3.js";import"./chunk-HC6MZPB3.js";import"./chunk-2SDYHWHI.js";import{a as ae}from"./chunk-32NLN7J2.js";import"./chunk-4PGTP63H.js";import"./chunk-FW7FQTSR.js";import"./chunk-FERD25SW.js";import"./chunk-HMTYJH34.js";import"./chunk-VFZRLGVJ.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-C5FLGXKQ.js";import"./chunk-Q7SJDITE.js";import"./chunk-MCRJI3T3.js";import"./chunk-MM5QLNJM.js";import"./chunk-NHOGAROI.js";import"./chunk-72KDLSWN.js";import{a as re}from"./chunk-3BWVIFHI.js";import"./chunk-6CACEU2V.js";import{F as oe}from"./chunk-ZGICK3R3.js";import{H as te,I as ie,L as ne,i as H,j as Y,k as G,l as K,m as $,o as Q,q as X,t as Z,z as ee}from"./chunk-C2NQIB3Y.js";import{Aa as i,Ba as M,Ca as p,Ea as D,Fa as P,Ga as V,L as y,M as x,Pa as J,U as N,V as r,W as h,Xa as L,Xb as z,Y as S,Ya as U,_b as q,aa as b,cb as _,ea as m,ib as W,ja as n,ka as e,kc as C,la as w,pa as R,qa as f,ra as v,za as B}from"./chunk-RFSKJ54S.js";import"./chunk-A2PWH3LV.js";import"./chunk-7KGURMOZ.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{g}from"./chunk-OLRFWS6T.js";var be=(()=>{let s=class s{constructor(a,l){this.modalCtrl=a,this.reviewService=l,this.message="",this.rating=5}ngOnInit(){}addReview(){return g(this,null,function*(){try{let a=yield this.reviewService.addReview(this.jobId,this.message,this.rating,this.recipientId);console.log("Review added:",a),this.modalCtrl.dismiss({submitted:!0},"submit")}catch(a){console.error("Error adding review:",a)}})}closeModal(){this.modalCtrl.dismiss(null,"cancel")}};s.\u0275fac=function(l){return new(l||s)(h(E),h(fe))},s.\u0275cmp=S({type:s,selectors:[["app-review-modal"]],inputs:{serviceId:"serviceId",jobId:"jobId",role:"role",recipientId:"recipientId"},decls:15,vars:2,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModelChange","ngModel"],["min","1","max","5","step","1","snaps","","pin","",3,"ngModelChange","ngModel"],["slot","start"],["slot","end"],["color","dark",3,"click"]],template:function(l,t){l&1&&(n(0,"ion-content",0)(1,"ion-item")(2,"ion-label",1),i(3,"Your Feedback"),e(),n(4,"ion-textarea",2),V("ngModelChange",function(c){return P(t.message,c)||(t.message=c),c}),e()(),n(5,"ion-item")(6,"ion-label"),i(7,"Rating"),e(),n(8,"ion-range",3),V("ngModelChange",function(c){return P(t.rating,c)||(t.rating=c),c}),n(9,"ion-label",4),i(10,"1"),e(),n(11,"ion-label",5),i(12,"5"),e()()(),n(13,"ion-button",6),f("click",function(){return t.addReview()}),i(14,"Submit"),e()()),l&2&&(r(4),D("ngModel",t.message),r(4),D("ngModel",t.rating))},dependencies:[_,C,z,q,ge,de,ce,me,ue,pe,he,le,se],encapsulation:2});let o=s;return o})();function xe(o,s){if(o&1&&w(0,"img",23),o&2){let u=v();m("src",u.otherPartyInfo.photoURL,N)}}function we(o,s){o&1&&(n(0,"div",24),w(1,"ion-icon",25),e())}function Se(o,s){if(o&1&&(n(0,"div",26)(1,"p")(2,"strong"),i(3,"Booking frequency:"),e(),i(4),e()()),o&2){let u=v();r(4),p(" ",u.bookingFrequency,"")}}function _e(o,s){if(o&1&&(n(0,"div",26)(1,"p")(2,"strong"),i(3,"Booking day of the month:"),e(),i(4),e()()),o&2){let u=v();r(4),p(" ",u.recurringDate,"th")}}function Ce(o,s){if(o&1&&(n(0,"div",26)(1,"p")(2,"strong"),i(3,"Every:"),e(),i(4),e()()),o&2){let u=v();r(4),p(" ",u.recurringDay,"")}}function Ee(o,s){if(o&1&&(n(0,"li"),i(1),e()),o&2){let u=s.$implicit;r(),M(u)}}function ke(o,s){if(o&1&&(n(0,"div")(1,"h3",6),i(2,"Extras"),e(),n(3,"ul",27),b(4,Ee,2,1,"li",28),e()()),o&2){let u=v();r(4),m("ngForOf",u.jobItems)}}function je(o,s){if(o&1){let u=R();n(0,"button",29),f("click",function(){y(u);let l=v();return x(l.openReviewModal())}),i(1," Add Review "),e()}}var He=(()=>{let s=class s{constructor(a,l,t,d,c){var A,O;this.modalController=a,this.router=l,this.availableJobsService=t,this.auth=d,this.userService=c,this.user=null,this.editMode=!1,this.role="user";let k=this.router.getCurrentNavigation(),I=(A=k==null?void 0:k.extras)==null?void 0:A.state;if(I){console.log(I),this.job=I.job,this.editMode=I.editMode,this.role=I.role,console.log(this.job),this.jobId=this.job.id,this.jobType=this.job.serviceType,this.userId=this.job.userId,this.price=this.job.totalCostToUser,this.additionalInfo=this.job.additionalInfo,this.bookingType=this.job.bookingType,this.scheduledDate=this.job.selectedTimeAndDate,this.userConfirmed=this.job.userConfirmed,this.cleanerConfirmed=(O=this.job)==null?void 0:O.cleanerConfirmed,this.bookingFrequency=this.job.recurringOption||"None",this.recurringDay=this.job.recurringDay||"N/A",this.recurringDate=this.job.recurringDate||"N/A";let F=this.job.selectedExtras;if(this.jobItems=F?F.split(",").map(j=>j.trim()):[],this.scheduledDate){let[j,T]=this.scheduledDate.split("T");this.scheduledDateOnly=j,this.scheduledTimeOnly=T==null?void 0:T.slice(0,5)}}else console.warn("No state data found. Redirecting back."),this.router.navigate(["/upcoming-jobs"])}ngOnInit(){this.auth.onAuthStateChanged(l=>g(this,null,function*(){this.user=l}));let a=this.role==="user"?this.job.cleanerID:this.job.userId;this.userService.getUserById(a).subscribe(l=>{this.otherPartyInfo=l},l=>{console.error("Error loading user:",l)})}backtoDash(){this.router.navigate(["/dashboard"])}startChat(a){this.user&&this.router.navigate([`/chat/${this.user.uid}-${a.uid}`])}markServiceComplete(){return g(this,null,function*(){if(!this.user||!this.jobId)return;let a=this.role==="service-provider"?"cleanerConfirmed":"userConfirmed";try{yield this.availableJobsService.updateJobConfirmation(this.jobId,a,!0),console.log(`${a} set to true`),this.checkAndFinalizeServiceCompletion()}catch(l){console.error("Error updating confirmation:",l)}})}checkAndFinalizeServiceCompletion(){return g(this,null,function*(){let a=yield this.availableJobsService.getJobById(this.jobId);if((a==null?void 0:a.cleanerConfirmed)&&(a==null?void 0:a.userConfirmed)){let t=this.job.cleanerID,d=Math.round((this.price||0)*.9);try{yield this.userService.addToCleanerAccount(t,d),console.log(`Credited R${d} to cleaner's account`),yield this.availableJobsService.markJobAsFinalized(this.jobId)}catch(c){console.error("Error finalizing service or crediting cleaner:",c)}}})}get shouldOnlyReview(){return!!(this.role==="user"&&this.userConfirmed||this.role==="service-provider"&&this.cleanerConfirmed)}get canReview(){return this.shouldOnlyReview}openReviewModal(){return g(this,null,function*(){let a=this.role==="user"?this.job.cleanerID:this.job.userId,l=yield this.modalController.create({component:be,componentProps:{jobId:this.jobId,role:this.role,recipientId:a},breakpoints:[0,.5,.8],initialBreakpoint:.5});yield l.present();let{data:t,role:d}=yield l.onDidDismiss();d==="submit"&&console.log("Review submitted:",t)})}};s.\u0275fac=function(l){return new(l||s)(h(E),h(W),h(ve),h(oe),h(ae))},s.\u0275cmp=S({type:s,selectors:[["app-view-service"]],decls:81,vars:22,consts:[["defaultAvatar",""],[3,"translucent"],["slot","start"],[3,"fullscreen"],[1,"p-4"],[1,"mb-4","shadow-md","rounded-2xl"],[1,"text-lg","font-semibold","text-gray-800"],[1,"space-y-4"],[1,"flex","items-center","gap-4"],["alt","Profile","class","w-16 h-16 rounded-full border-2 border-primary",3,"src",4,"ngIf","ngIfElse"],[1,"text-sm","text-gray-700"],["expand","block","color","primary",1,"mt-2","shadow-md",3,"click"],[1,"bg-white","rounded-2xl","shadow-md","p-6","space-y-6"],[1,"text-center","text-xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-700","space-y-1"],["class","text-sm text-red-700",4,"ngIf"],[4,"ngIf"],[1,"text-sm","text-blue-700"],[1,"flex","flex-col","md:flex-row","gap-4"],[1,"w-full","bg-red-600","hover:bg-red-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"click","disabled"],[1,"w-full","bg-yellow-600","hover:bg-yellow-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"disabled"],["color","success",3,"click","disabled"],["class","w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 rounded-lg text-sm shadow transition",3,"click",4,"ngIf"],["alt","Profile",1,"w-16","h-16","rounded-full","border-2","border-primary",3,"src"],[1,"w-16","h-16","bg-gray-300","rounded-full","flex","items-center","justify-center","text-white","text-lg"],["name","person-outline"],[1,"text-sm","text-red-700"],[1,"list-disc","list-inside","text-sm","text-gray-700","space-y-1"],[4,"ngFor","ngForOf"],[1,"w-full","bg-indigo-600","hover:bg-indigo-700","text-white","font-medium","py-3","rounded-lg","text-sm","shadow","transition",3,"click"]],template:function(l,t){if(l&1){let d=R();n(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),w(3,"ion-menu-button"),e(),n(4,"ion-title"),i(5,"viewService"),e()()(),n(6,"ion-content",3),w(7,"app-global-background"),n(8,"div",4)(9,"ion-card",5)(10,"ion-card-header")(11,"ion-card-title",6),i(12),e()(),n(13,"ion-card-content",7)(14,"div",8),b(15,xe,1,1,"img",9)(16,we,2,0,"ng-template",null,0,J),n(18,"div")(19,"p",10)(20,"strong"),i(21,"Name:"),e(),i(22),e(),n(23,"p",10)(24,"strong"),i(25,"Email:"),e(),i(26),e()()(),n(27,"ion-button",11),f("click",function(){return y(d),x(t.startChat(t.otherPartyInfo))}),i(28," Start Chat "),e()()(),n(29,"div",12)(30,"h2",13),i(31," Details About Your Clean "),e(),n(32,"div",14)(33,"p")(34,"strong"),i(35,"Service:"),e(),i(36),e(),n(37,"p")(38,"strong"),i(39,"Preferred Date:"),e(),i(40),e(),n(41,"p")(42,"strong"),i(43,"Offered Rate:"),e(),i(44),e()(),n(45,"div",10)(46,"p")(47,"strong"),i(48,"Location:"),e(),i(49," Randpark, Randburg"),e()(),n(50,"div",10)(51,"p")(52,"strong"),i(53,"Booking Type:"),e(),i(54),e()(),b(55,Se,5,1,"div",15)(56,_e,5,1,"div",15)(57,Ce,5,1,"div",15),n(58,"div",10)(59,"p")(60,"strong"),i(61,"Scheduled Date:"),e(),i(62),e(),n(63,"p")(64,"strong"),i(65,"Scheduled Time:"),e(),i(66),e()(),b(67,ke,5,1,"div",16),n(68,"div")(69,"h3",6),i(70," Additional Instructions "),e(),n(71,"p",17),i(72),e()(),n(73,"div",18)(74,"button",19),f("click",function(){return y(d),x(t.backtoDash())}),i(75," Decline "),e(),n(76,"button",20),i(77," Cancel "),e(),n(78,"ion-button",21),f("click",function(){return y(d),x(t.markServiceComplete())}),i(79," Mark Service as Completed "),e(),b(80,je,2,0,"button",22),e()()()()}if(l&2){let d=B(17);m("translucent",!0),r(6),m("fullscreen",!0),r(6),p(" ",t.role==="service-provider"?"Client":"Cleaner"," Info "),r(3),m("ngIf",t.otherPartyInfo==null?null:t.otherPartyInfo.photoURL)("ngIfElse",d),r(7),p(" ",(t.otherPartyInfo==null?null:t.otherPartyInfo.displayName)||"N/A"," "),r(4),p(" ",(t.otherPartyInfo==null?null:t.otherPartyInfo.email)||"N/A"," "),r(10),p(" ",t.jobType,""),r(4),p(" ",t.scheduledDate,""),r(4),p(" R",t.price,""),r(10),p(" ",t.bookingType,""),r(),m("ngIf",t.bookingType==="Re-occurring"&&t.bookingFrequency),r(),m("ngIf",t.bookingType==="Re-occurring"&&t.recurringDate),r(),m("ngIf",t.bookingType==="Re-occurring"&&t.recurringDay),r(5),p(" ",t.scheduledDateOnly,""),r(4),p(" ",t.scheduledTimeOnly,""),r(),m("ngIf",t.jobItems==null?null:t.jobItems.length),r(5),M(t.additionalInfo),r(2),m("disabled",t.shouldOnlyReview),r(2),m("disabled",t.shouldOnlyReview),r(2),m("disabled",t.shouldOnlyReview),r(2),m("ngIf",t.canReview)}},dependencies:[K,Q,$,G,H,ne,Y,X,Z,te,ee,ie,_,L,U,C,re],encapsulation:2});let o=s;return o})();export{He as ViewtServicePage};
