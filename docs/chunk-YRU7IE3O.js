import{a as le}from"./chunk-BTEGK24M.js";import{E as re,H as ae,h as Z,r as D,s as ee,t as te,u as ie,w as ne,y as oe}from"./chunk-BKWKOILY.js";import{C as Q,G as X,H as Y,b as U,c as F,h as V,i as R,j as q,k as z,l as B,m as $,o as H,p as L,q as W,t as G,w as K}from"./chunk-FYZ4SEYQ.js";import{$ as b,A as C,Aa as A,Ba as d,D as I,Fa as P,K as x,L as g,Ra as T,Sa as O,U as c,V as h,Va as _,Wa as j,X as M,Zb as N,da as u,ia as o,j as y,ja as i,ka as k,n as v,oa as S,pa as f,qa as m,za as r}from"./chunk-C7Y544BQ.js";import"./chunk-A2PWH3LV.js";import"./chunk-7KGURMOZ.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as J,b as w}from"./chunk-OLRFWS6T.js";var se=(()=>{let a=class a{constructor(e,t){this.firestore=e,this.auth=t}getServiceReviews(){let e=oe(this.firestore,"service-requests"),t=re(e,ae("isAvailable","==",!0));return console.log("here is q: "+t),ne(t,{idField:"id"}).pipe(v(l=>l.map(p=>{var E;return w(J({},p),{createdAt:((E=p.createdAt)==null?void 0:E.toDate())||new Date})})))}getUserName(e){let t=D(this.firestore,"users",e);return y(ee(t)).pipe(v(l=>{if(l.exists()){let p=l.data();return(p==null?void 0:p.displayName)||"Unknown"}else return"Unknown"}))}updateJobStatus(e,t){let l=D(this.firestore,"service-requests",e);return te(l,{isAvailable:!1,cleanerID:t.uid})}};a.\u0275fac=function(t){return new(t||a)(I(ie),I(Z))},a.\u0275prov=C({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function pe(s,a){s&1&&(o(0,"ion-badge",6),r(1,"Available"),i())}function me(s,a){if(s&1){let n=S();o(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),r(3),i(),b(4,pe,2,0,"ion-badge",3),i(),o(5,"ion-card-content")(6,"p"),r(7),i(),o(8,"p"),r(9),i(),o(10,"p"),r(11),i(),o(12,"ion-row")(13,"ion-col")(14,"ion-button",4),f("click",function(){let t=x(n).$implicit,l=m();return g(l.acceptJob(t,l.user))}),r(15,"Accept"),i()(),o(16,"ion-col")(17,"ion-button",5),f("click",function(){let t=x(n).$implicit,l=m();return g(l.declineJob(t))}),r(18,"Decline"),i()()()()()}if(s&2){let n=a.$implicit,e=m();c(3),A(n.selectedProperty==null?null:n.selectedProperty.propertyType),c(),u("ngIf",n.isAvailable),c(3),d("Client: ",e.userNames[n.userId]||"Unknown",""),c(2),d("Extras: ",n.selectedExtras,""),c(2),d("Scheduled for: ",e.formatScheduledDate(n.selectedTimeAndDate),"")}}function be(s,a){if(s&1&&(o(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),r(3),i()(),o(4,"ion-card-content")(5,"p")(6,"strong"),r(7,"Extras:"),i(),r(8),i(),o(9,"p")(10,"strong"),r(11,"Scheduled Time:"),i(),r(12),i(),o(13,"p")(14,"strong"),r(15,"Status:"),i(),r(16),i(),o(17,"p")(18,"strong"),r(19,"Created At:"),i(),r(20),i()()()),s&2){let n=m(2);c(3),A(n.selectedJob.selectedProperty),c(5),d(" ",n.selectedJob.selectedExtras,""),c(4),d(" ",n.formatScheduledDate(n.selectedJob.selectedTimeAndDate),""),c(4),d(" ",n.selectedJob.isAvailable?"Available":"Assigned",""),c(4),d(" ",n.selectedJob.createdAt,"")}}function ue(s,a){if(s&1){let n=S();o(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),r(3,"Job Details"),i(),o(4,"ion-buttons",7)(5,"ion-button",8),f("click",function(){x(n);let t=m();return g(t.closeModal())}),r(6,"Close"),i()()()(),o(7,"ion-content"),b(8,be,21,5,"ion-card",9),i()}if(s&2){let n=m();c(8),u("ngIf",n.selectedJob)}}var ye=(()=>{let a=class a{constructor(e,t,l){this.availableJobsService=e,this.datePipe=t,this.authService=l,this.user=null,this.jobs=[],this.userNames={},this.isModalOpen=!1}ngOnInit(){this.fetchUserDetails(),this.getAvailableJobs()}formatScheduledDate(e){return this.datePipe.transform(e,"HH:mm yyyy-MM-dd")||""}getAvailableJobs(){this.availableJobsService.getServiceReviews().subscribe(e=>{this.jobs=e,this.fetchUserNames()},e=>{console.error("Error fetching available jobs:",e)})}fetchUserNames(){this.jobs.forEach(e=>{e.userId&&!this.userNames[e.userId]&&this.availableJobsService.getUserName(e.userId).subscribe(t=>{this.userNames[e.userId]=t})})}acceptJob(e,t){if(!t){console.error("User is not logged in");return}if(!e.id){console.error("Job ID is undefined");return}this.availableJobsService.updateJobStatus(e.id,t).then(()=>{console.log(`Job ${e.id} has been accepted and updated.`),e.isAvailable=!1,e.cleanerID=t.uid}).catch(l=>{console.error("Error accepting the job:",l)})}declineJob(e){e.isAvailable=!0,console.log(`Declined job: ${e.id}`)}fetchUserDetails(){this.authService.getCurrentUser().subscribe(e=>{this.user=e})}viewInfo(e){this.selectedJob=e,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}};a.\u0275fac=function(t){return new(t||a)(h(se),h(_),h(le))},a.\u0275cmp=M({type:a,selectors:[["app-available-jobs"]],features:[P([_])],decls:11,vars:2,consts:[["slot","start"],[4,"ngFor","ngForOf"],[3,"ionModalDidDismiss","isOpen"],["color","primary",4,"ngIf"],[1,"Accept",3,"click"],[1,"Decline",3,"click"],["color","primary"],["slot","end"],[3,"click"],[4,"ngIf"]],template:function(t,l){t&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),k(3,"ion-back-button"),i(),o(4,"ion-title"),r(5,"Available Jobs"),i()()(),o(6,"ion-content")(7,"ion-list"),b(8,me,19,5,"ion-card",1),i(),o(9,"ion-modal",2),f("ionModalDidDismiss",function(){return l.closeModal()}),b(10,ue,9,1,"ng-template"),i()()),t&2&&(c(8),u("ngForOf",l.jobs),c(),u("isOpen",l.isModalOpen))},dependencies:[F,L,Q,R,B,H,$,z,K,U,q,V,W,G,X,Y,j,T,O,N],styles:["ion-badge[_ngcontent-%COMP%]{font-size:.8rem;padding:5px 10px;border-radius:5px}ion-card[_ngcontent-%COMP%]{margin-bottom:10px}.Accept[_ngcontent-%COMP%]{margin:0 auto;width:60%;font-size:.8rem;height:10px;text-align:center;font-style:normal;font-weight:700;font-size:10px;line-height:100%;--background: #1E232C;--color: White;--border-radius: 100px;--border-color: #000;--border-style: solid;--border-width: 1px;--box-shadow: 0 2px 6px 0 rgb(0, 0, 0, .25);--ripple-color: deeppink;--padding-top: 10px;--padding-bottom: 10px}.Decline[_ngcontent-%COMP%]{margin:0 auto;width:60%;font-size:.8rem;height:10px;text-align:center;font-style:normal;font-weight:700;font-size:10px;line-height:18px;--background: #DADADA;--color: black;--border-radius: 100px;--border-color: #000;--border-style: solid;--border-width: 1px;--box-shadow: 0 2px 6px 0 rgb(0, 0, 0, .25);--ripple-color: deeppink;--padding-top: 10px;--padding-bottom: 10px}"]});let s=a;return s})();export{ye as AvailableJobsPage};
