import{a as X}from"./chunk-LB7EHPFM.js";import{a as K}from"./chunk-3BWVIFHI.js";import{a as Q}from"./chunk-ZZSRRRLF.js";import"./chunk-6CACEU2V.js";import"./chunk-ZGICK3R3.js";import{H as Y,I as q,M as J,b as j,g as A,i as z,j as L,q as W,r as H,t as R,u as G,w as V}from"./chunk-C2NQIB3Y.js";import{Aa as m,Ba as u,Ea as w,Fa as O,Ga as U,La as v,Ma as P,U as C,V as a,W as f,Xa as E,Xb as F,Y as b,Ya as k,_a as T,_b as N,aa as d,cb as D,ea as l,fa as y,gb as B,ja as r,k as M,ka as o,kc as $,la as g,m as x,qa as S,ra as p}from"./chunk-RFSKJ54S.js";import"./chunk-A2PWH3LV.js";import"./chunk-7KGURMOZ.js";import"./chunk-2ERDAVOU.js";import"./chunk-S2UWYFTU.js";import"./chunk-7DVLVN3P.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-BTS5SJXR.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{g as _}from"./chunk-OLRFWS6T.js";function Z(t,n){if(t&1&&(r(0,"ion-avatar",0),g(1,"img",11),o()),t&2){let i=p().$implicit;a(),l("src",i.senderImage,C)}}function ee(t,n){if(t&1&&(r(0,"strong"),m(1),o()),t&2){let i=p().$implicit;a(),u(i.sender)}}function te(t,n){if(t&1&&(r(0,"ion-avatar",12),g(1,"img",13),o()),t&2){let i=p(3);a(),l("src",i.currentUserImage,C)}}function ne(t,n){if(t&1&&(r(0,"ion-item"),d(1,Z,2,1,"ion-avatar",8),r(2,"div",9),d(3,ee,2,1,"strong",3),r(4,"p"),m(5),o()(),d(6,te,2,1,"ion-avatar",10),o()),t&2){let i=n.$implicit,e=p(2);y("sender",i.senderId===e.currentUserId)("receiver",i.senderId!==e.currentUserId),a(),l("ngIf",i.senderId!==e.currentUserId),a(2),l("ngIf",i.senderId!==e.currentUserId),a(2),u(i.text),a(),l("ngIf",i.senderId===e.currentUserId)}}function ie(t,n){if(t&1&&(r(0,"ion-list"),d(1,ne,7,8,"ion-item",7),o()),t&2){let i=n.ngIf;a(),l("ngForOf",i)}}function re(t,n){t&1&&(r(0,"div",14)(1,"p"),m(2,"No messages yet. Start the conversation!"),o()())}var ue=(()=>{let n=class n{constructor(e,c,s){this.route=e,this.chatService=c,this.authService=s,this.newMessage="",this.currentUserId="",this.currentUserImage="",this.chatPartnerId="",this.chatPartnerName="Chat Partner",this.chatPartnerImage=""}ngOnInit(){return _(this,null,function*(){let e=this.route.snapshot.paramMap.get("chatId")||"";if(console.log(e),console.log("chatPartnerId from route:",e),e){let[c,s]=e.split("-");console.log("Current User ID:",c),console.log("Chat Partner ID:",s),this.currentUserId=c,this.chatPartnerId=s,this.loadMessages(),console.log(this.messages$)}else console.warn("Chat partner ID is missing.")})}loadCurrentUser(){return _(this,null,function*(){try{let e=yield x(this.authService.getCurrentUser());e&&(this.currentUserId=e.uid,this.currentUserImage=e.photoURL||"")}catch(e){console.error("Error fetching user:",e)}})}loadMessages(){if(console.log(this.currentUserId," and ",this.chatPartnerId),!this.currentUserId||!this.chatPartnerId){console.warn("Current user ID or chat partner ID is missing"),this.messages$=M([]);return}this.messages$=this.chatService.getMessages(this.currentUserId,this.chatPartnerId)}sendMessage(){if(this.newMessage.trim()!==""){let e={text:this.newMessage,senderId:this.currentUserId,senderImage:this.currentUserImage,receiverId:this.chatPartnerId,receiverImage:this.chatPartnerImage,timestamp:new Date().toISOString()};this.chatService.sendMessage(e.text,e.senderId,e.senderImage,e.receiverId,e.receiverImage).then(()=>{this.newMessage=""}).catch(c=>{console.error("Error sending message:",c)})}}};n.\u0275fac=function(c){return new(c||n)(f(B),f(X),f(Q))},n.\u0275cmp=b({type:n,selectors:[["app-chat"]],decls:17,vars:8,consts:[["slot","start"],["defaultHref","/"],[1,"chat-container"],[4,"ngIf"],["class","empty-chat",4,"ngIf"],["placeholder","Type a message",3,"ngModelChange","ngModel"],[3,"click"],[3,"sender","receiver",4,"ngFor","ngForOf"],["slot","start",4,"ngIf"],[1,"chat-bubble"],["slot","end",4,"ngIf"],["alt","Profile Picture",3,"src"],["slot","end"],["alt","Your Profile Picture",3,"src"],[1,"empty-chat"]],template:function(c,s){if(c&1&&(r(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),g(3,"ion-back-button",1),o(),r(4,"ion-title"),m(5),o()()(),r(6,"ion-content",2),g(7,"app-global-background"),d(8,ie,2,1,"ion-list",3),v(9,"async"),d(10,re,3,0,"div",4),v(11,"async"),o(),r(12,"ion-footer")(13,"ion-toolbar")(14,"ion-input",5),U("ngModelChange",function(I){return O(s.newMessage,I)||(s.newMessage=I),I}),o(),r(15,"ion-button",6),S("click",function(){return s.sendMessage()}),m(16,"Send"),o()()()),c&2){let h;a(5),u(s.chatPartnerName),a(3),l("ngIf",P(9,4,s.messages$)),a(2),l("ngIf",((h=P(11,6,s.messages$))==null?null:h.length)===0),a(4),w("ngModel",s.newMessage)}},dependencies:[A,j,L,G,V,H,z,J,W,R,Y,q,D,E,k,T,$,F,N,K],styles:[".chat-container[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{padding:10px}.chat-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:10px;margin:5px 0;max-width:80%;word-wrap:break-word}.chat-container[_ngcontent-%COMP%]   .chat-bubble[_ngcontent-%COMP%]{padding:10px;border-radius:12px;font-size:16px;max-width:75%;word-wrap:break-word}.chat-container[_ngcontent-%COMP%]   .sender[_ngcontent-%COMP%]{align-self:flex-end;justify-content:flex-end;background:#007bff;color:#fff}.chat-container[_ngcontent-%COMP%]   .sender[_ngcontent-%COMP%]   .chat-bubble[_ngcontent-%COMP%]{background:#007bff;color:#fff}.chat-container[_ngcontent-%COMP%]   .receiver[_ngcontent-%COMP%]{align-self:flex-start;justify-content:flex-start;background:#f1f0f0;color:#000}.chat-container[_ngcontent-%COMP%]   .receiver[_ngcontent-%COMP%]   .chat-bubble[_ngcontent-%COMP%]{background:#f1f0f0;color:#000}.chat-container[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:40px;height:40px}"]});let t=n;return t})();export{ue as ChatPage};
